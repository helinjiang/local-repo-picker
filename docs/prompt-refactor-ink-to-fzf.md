# AI Promptï¼šå°† local-repo-picker çš„äº¤äº’å±‚ä» Ink TUI æ”¹ä¸º fzfï¼ˆä¿ç•™æ ¸å¿ƒ Git å¤„ç†ï¼‰

ä½ æ˜¯ä¸€ä¸ªèµ„æ·± TypeScript/Node CLI å·¥ç¨‹å¸ˆã€‚æˆ‘ä»¬å·²ç»å®Œæˆäº† local-repo-pickerï¼ˆStep 0â€“12ï¼‰çš„å…¨éƒ¨å®ç°ï¼Œä½†å‘ç° **Ink + React çš„ TUI ä½“éªŒä¸å¦‚ fzf**ã€‚  
ç°åœ¨è¦åšä¸€æ¬¡â€œ**äº¤äº’å±‚æ›¿æ¢**â€ï¼šæŠŠ UI ä» Ink æ”¹ä¸º **fzf**ï¼Œä½† **ä¸è¦æ¨å€’é‡æ¥**ï¼Œè¦æœ€å¤§åŒ–å¤ç”¨ç°æœ‰çš„æ‰«æã€ç¼“å­˜ã€tagã€LRUã€git previewã€configã€actions ç­‰æ ¸å¿ƒé€»è¾‘ã€‚

è¯·ç›´æ¥è¾“å‡ºä¸€ä»½å¯è¿è¡Œçš„ä»£ç æ”¹é€ æ–¹æ¡ˆï¼ˆåŒ…å«éœ€è¦ä¿®æ”¹/æ–°å¢çš„æ–‡ä»¶å†…å®¹æˆ–è¡¥ä¸ï¼‰ï¼Œå¹¶ç¡®ä¿é€šè¿‡éªŒæ”¶æ ‡å‡†ã€‚

---

## ğŸ¯ æ”¹é€ ç›®æ ‡

- äº¤äº’å±‚ï¼š**Ink UI â†’ fzf**
- ä¿ç•™ï¼šæ‰€æœ‰æ ¸å¿ƒèƒ½åŠ›ï¼ˆæ‰«æ / cache / tag / LRU / preview æ•°æ®æ„å»º / actions / config è·¯å¾„ç­–ç•¥ / å®‰å…¨ç­–ç•¥ï¼‰
- CLIï¼š`repo` å‘½ä»¤ä»ç„¶å­˜åœ¨ï¼Œè¡Œä¸ºä¿æŒä¸€è‡´ï¼ˆä»… UI å˜æ›´ï¼‰
- Libraryï¼š`import pickRepo from 'local-repo-picker'` ä»å¯ç”¨ï¼ˆå†…éƒ¨ä½¿ç”¨ fzfï¼‰

---

## âœ… å¿…é¡»è¦æ±‚ï¼ˆç¡¬æ€§ï¼‰

### 1) ä¿ç•™æ ¸å¿ƒæ¨¡å—ä¸æ•°æ®ç»“æ„

ä»¥ä¸‹æ¨¡å—ï¼ˆæˆ–ç­‰ä»·èŒè´£ï¼‰å¿…é¡»ä¿ç•™å¹¶å¤ç”¨ï¼Œä¸å…è®¸é‡å†™æˆè„šæœ¬å¼ä¸€å¨ä»£ç ï¼š

- `scan` / `indexer`ï¼šæ‰«æ repoï¼ˆmulti scanRoots, maxDepth, pruneï¼‰
- `cache`ï¼šTTL + rebuild + metadata
- `tags`ï¼šauto + remote + dirty + manual tags
- `lru`ï¼šæœ€è¿‘ä½¿ç”¨
- `git`ï¼šorigin/branch/status/ahead-behind/commits/readme
- `preview`ï¼šé¢„è§ˆæ•°æ®æ„å»ºï¼ˆæƒ°æ€§/ç¼“å­˜/å¹¶å‘é™åˆ¶ï¼‰
- `config`ï¼šenv-pathsã€config.jsonã€repo --config
- `actions`ï¼šopen in VSCode / iTerm / Finder / add tag / refresh cache ç­‰

ä½ å¯ä»¥è°ƒæ•´æ–‡ä»¶ç»“æ„ï¼Œä½†è¦åšåˆ°â€œæ ¸å¿ƒé€»è¾‘å¯ç‹¬ç«‹æµ‹è¯•ã€å¯å¤ç”¨â€ã€‚

---

### 2) ä½¿ç”¨ fzf å®Œæˆäº¤äº’ï¼ˆæ›¿ä»£ Inkï¼‰

- ä¸ä½¿ç”¨ Ink / Reactï¼ˆå¯ä»¥ä¿ç•™ä¾èµ–ä½†é»˜è®¤è·¯å¾„ä¸å†ç”¨ï¼‰
- äº¤äº’å¿…é¡»åŸºäº `fzf`ï¼ˆä¾èµ–ç”¨æˆ·å·²å®‰è£…ï¼‰
- è‹¥æœªå®‰è£… fzfï¼š
  - CLI å¿…é¡»ç»™å‡ºæ˜ç¡®æç¤ºï¼ˆmacOSï¼šbrew install fzfï¼‰
  - ç¨‹åºé€€å‡ºç é 0

---

### 3) ä¿ç•™å¹¶å¢å¼º fzf-like é¢„è§ˆä½“éªŒ

å¿…é¡»å®ç° fzf çš„ `--preview`ï¼š

- å·¦ä¾§åˆ—è¡¨ï¼šå±•ç¤º **owner/repo ä¼˜å…ˆ**ï¼ˆæ‹¿ä¸åˆ°åˆ™ repo basenameï¼‰ï¼Œå¹¶æ˜¾ç¤º tags
- å³ä¾§ previewï¼šæ˜¾ç¤ºä¸æ—§ Ink é¢„è§ˆä¸€è‡´çš„ä¿¡æ¯ï¼š
  - PATHï¼ˆç»å¯¹è·¯å¾„ï¼‰
  - ORIGINï¼ˆå°½é‡ä¸è°ƒç”¨ gitï¼šä¼˜å…ˆè§£æ configï¼›å…œåº• gitï¼‰
  - BRANCH
  - STATUSï¼ˆdirty/cleanï¼‰
  - SYNCï¼ˆahead/behindï¼‰
  - RECENT COMMITSï¼ˆ12 æ¡ï¼Œæ—¶é—´ç²¾ç¡®åˆ°ç§’ï¼‰
  - READMEï¼ˆâ‰¤200 è¡Œï¼‰
- æ€§èƒ½ï¼š
  - é¢„è§ˆä¸è¦æ¯æ¬¡éƒ½å…¨é‡è°ƒç”¨ gitï¼ˆå¯ç”¨ç¼“å­˜ï¼‰
  - å…è®¸ preview èµ°â€œå¿«é€Ÿè·¯å¾„â€ï¼šå…ˆå±•ç¤ºå·²æœ‰ cache ä¿¡æ¯ï¼Œå†å¼‚æ­¥è¡¥å…¨ï¼ˆå¦‚æœå®ç°å¤æ‚ï¼Œå…ˆåšåŒæ­¥ç‰ˆä½†è¦æœ‰å¹¶å‘é™åˆ¶ä¸è¶…æ—¶ï¼‰

> æ³¨æ„ï¼šfzf preview åœ¨å­è¿›ç¨‹é‡Œè¿è¡Œå‘½ä»¤ã€‚ä½ éœ€è¦è®¾è®¡ä¸€ä¸ªå¯å¤ç”¨çš„å†…éƒ¨å­å‘½ä»¤ï¼ˆå¦‚ `repo __preview --path <repo>`ï¼‰ï¼Œé¿å…æŠŠå¤æ‚é€»è¾‘å†™è¿›ä¸€è¡Œ shellã€‚

---

### 4) äº¤äº’åŠŸèƒ½ä¸å¿«æ·é”®ï¼ˆé…ç½®é©±åŠ¨ï¼‰

fzf äº¤äº’éœ€è¦æ”¯æŒï¼š

- æœç´¢ï¼ˆfzf é»˜è®¤ï¼‰
- Enter é€‰æ‹© repo
- Esc é€€å‡ºï¼ˆè¿”å› nullï¼‰
- tag è¿‡æ»¤å¿«æ·é”®ï¼ˆæ¥è‡ª config.jsonï¼‰ï¼š
  - Ctrl+B åªçœ‹ [byted]
  - Ctrl+G åªçœ‹ [github]
  - Ctrl+E åªçœ‹ [gitee]
  - Ctrl+D åªçœ‹ [dirty]
  - Ctrl+A æ¢å¤ all
- è¿™äº›å¿«æ·é”®å¿…é¡»æ¥è‡ªé…ç½®ï¼ˆå¦‚ `fzfTagFilters`ï¼‰ï¼Œä¸è¦å†™æ­»åœ¨ä»£ç é‡Œ

---

### 5) Actionsï¼ˆé€‰æ‹© repo åçš„åŠ¨ä½œï¼‰

é€‰æ‹© repo åï¼Œæä¾›åŠ¨ä½œé€‰æ‹©ï¼ˆå¯ä»¥ç”¨ç¬¬äºŒä¸ª fzfï¼‰ï¼š

- open in VSCode
- open in iTerm
- open in Finder
- add tagï¼ˆç¼–è¾‘ repo_tags å¹¶åˆ·æ–° cacheï¼‰
- refresh cache
- å…¶ä»–ç°æœ‰ actions ä¿ç•™

---

### 6) å®‰å…¨è¦æ±‚

- å¤–éƒ¨å‘½ä»¤ä¸€å¾‹ç”¨ `execa`ï¼Œç¦æ­¢ `shell: true`
- è·¯å¾„å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„
- ä¸å…è®¸æŠŠ repo path ç›´æ¥æ‹¼è¿› shell å‘½ä»¤å­—ç¬¦ä¸²ï¼ˆå°¤å…¶æ˜¯ previewï¼‰
- preview å‘½ä»¤å»ºè®®ï¼š
  - `repo __preview --path <abs>` è¿™ç§å‚æ•°å½¢å¼
  - å‚æ•°å¿…é¡»é€šè¿‡ args æ•°ç»„å®‰å…¨ä¼ é€’

---

## ğŸ§© è®¾è®¡å»ºè®®ï¼ˆè¯·æŒ‰æ­¤å®ç°ï¼‰

### A) æ–°å¢å†…éƒ¨å­å‘½ä»¤ï¼š`repo __preview --path <repo>`

- åªè´Ÿè´£ï¼š
  - è¯»å– repo é¢„è§ˆæ•°æ®ï¼ˆå¤ç”¨ç°æœ‰ preview builderï¼‰
  - è¾“å‡ºçº¯æ–‡æœ¬åˆ° stdoutï¼ˆå¯å¸¦ ANSIï¼‰
- fzf ä¸­ä½¿ç”¨ `{2}` å– pathï¼š
  - `--preview 'repo __preview --path {2}'`

### B) æ–°å¢å†…éƒ¨å­å‘½ä»¤ï¼š`repo __list [--filter-tag <tag>] [--all]`

- è¾“å‡º TSVï¼š
  - col1: displayï¼ˆowner/repo + ANSI tagsï¼‰
  - col2: pathï¼ˆç»å¯¹è·¯å¾„ï¼‰
  - col3: rawTagsï¼ˆç”¨äºè¿‡æ»¤ï¼‰
- é»˜è®¤èµ° cacheï¼Œä¸è§¦å‘å…¨é‡ scanï¼ˆé™¤é cache è¿‡æœŸï¼‰
- fzf è¾“å…¥æ¥è‡ªï¼š`repo __list --all`
- ä½¿ç”¨ `--delimiter=$'\t' --with-nth=1`

### C) tag å¿«æ·é”®è¿‡æ»¤å®ç°ï¼ˆé¿å… awk/sedï¼‰

- ç”¨ `--bind ctrl-b:reload(repo __list --filter-tag [byted])`
- `ctrl-a:reload(repo __list --all)`

---

## ğŸ§ª éªŒæ”¶æ ‡å‡†ï¼ˆå¿…é¡»æ»¡è¶³ï¼‰

1. `repo` èƒ½å¯åŠ¨ fzf åˆ—è¡¨ï¼Œå·¦ä¾§æ˜¾ç¤º owner/repo + tags
2. ä¸Šä¸‹ç§»åŠ¨æ—¶å³ä¾§ preview å®æ—¶åˆ·æ–°ï¼Œä¸”åŒ…å« commits æ—¶é—´åˆ°ç§’
3. Enter é€‰ä¸­ repo åï¼Œèƒ½è¿›å…¥ action é€‰æ‹©ï¼Œå¹¶æ‰§è¡Œ action
4. Ctrl+B/Ctrl+G/Ctrl+E/Ctrl+D è¿‡æ»¤ç”Ÿæ•ˆï¼›Ctrl+A æ¢å¤
5. `repo --config` ä»å¯ç”¨ï¼Œé…ç½®èƒ½å½±å“ scanRoots / prune / å¿«æ·é”®
6. æœªå®‰è£… fzf æ—¶ç»™å‡ºæ˜ç¡®æç¤ºå¹¶é€€å‡º
7. ä»£ç ç»“æ„æ¸…æ™°ï¼šæ ¸å¿ƒé€»è¾‘ä¸äº¤äº’å±‚è§£è€¦ï¼ˆæœªæ¥å¯å†åˆ‡å› Ink æˆ– Webï¼‰

---

## ğŸ“¦ è¾“å‡ºè¦æ±‚

- ä¿®æ”¹åçš„é¡¹ç›®æ–‡ä»¶æ ‘
- æ¯ä¸ªå˜æ›´æ–‡ä»¶çš„å®Œæ•´å†…å®¹ï¼ˆæˆ– patchï¼‰
- README æ›´æ–°ï¼š
  - ä¾èµ– fzf çš„è¯´æ˜
  - å¿«æ·é”®è¯´æ˜
  - preview çš„è¯´æ˜
- internal å­å‘½ä»¤ï¼ˆ**preview / **listï¼‰åœ¨ README æ ‡æ³¨ä¸º internal

---

## âš ï¸ çº¦æŸ

- ä¸è¦æŠŠå¤æ‚é€»è¾‘å¡è¿›ä¸€æ®µé•¿ shell preview å­—ç¬¦ä¸²
- ä¸è¦ç‰ºç‰²å®‰å…¨ï¼ˆç¦æ­¢ shell æ³¨å…¥ï¼‰
- ä¸è¦ç ´åç°æœ‰ import API
- åªæ›¿æ¢äº¤äº’å±‚ï¼šInk ä»£ç å¯ä¿ç•™ä½†ä¸ä½œä¸ºé»˜è®¤è·¯å¾„

ç°åœ¨å¼€å§‹å®æ–½æ”¹é€ ã€‚
